generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  ASSOCIATE
  MANAGER
}

enum LeadState {
  NEW
  NO_ANSWER
  CALL_LATER
  BOOKED
  REFUSED
  SKIP
}

model Sale {
  id        String   @id @default(cuid())
  contactId String
  contact   Contact  @relation("ContactSales", fields: [contactId], references: [id])
  userId    String
  user      User     @relation("UserSales", fields: [userId], references: [id])
  amount    Float?
  createdAt DateTime @default(now())
}

model User {
  id           String   @id @default(cuid())
  name         String
  email        String   @unique
  passwordHash String
  role         Role     @default(ASSOCIATE)
  createdAt    DateTime @default(now())

  // rela√ß√£o que j√° tinhas (pendentes atribu√≠dos)
  contacts Contact[] @relation("AssignedContacts")

  //   novos ‚Äúlados opostos‚Äù
  sessions      CallSession[]  @relation("UserSessions")
  contactTimers ContactTimer[] @relation("UserContactTimers")
  sales         Sale[]         @relation("UserSales")
}

enum SegmentKey {
  A_CONSTRUCAO_SERVICOS_LAR
  B_RESTAURACAO_CAFES_PASTELARIAS
  C_CABELEIREIROS_BARBEARIAS_ESTETICA
  D_OFICINAS_AUTO_PNEUS_SERVICOS_AUTO
  E_MERCEARIAS_MERCADOS_PADARIAS
  F_LOJAS_ROUPA_CALCADO_DECORACAO
  G_CLINICAS_SAUDE_WELLNESS
  H_ALOJAMENTO_LOCAL_HOTEIS
  I_ESCOLAS_CURSOS_CENTROS_ESTUDO
  J_PROFISSIONAIS_LIBERAIS_SERVICOS
}

model Contact {
  id          String  @id @default(cuid())
  firstName   String?
  lastName    String?
  companyName String
  title       String?
  email       String?
  emailStatus String?
  phoneWork   String?
  phoneMobile String?
  phoneCorp   String?
  industry    String? // aqui podes p√¥r a "Category" do CSV (ex: Pastelaria)
  keywords    String?
  website     String?
  companyCity String?

  segmentKey SegmentKey? // üëà bucket A‚ÄìJ

  state       LeadState @default(NEW)
  callNote    String?
  callLaterAt DateTime?
  noAnswerAt  DateTime?

  reviveAt      DateTime?
  noAnswerCount Int       @default(0)
  lastCalledAt  DateTime?

  assignedToId String?
  assignedTo   User?   @relation("AssignedContacts", fields: [assignedToId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  timers ContactTimer[] @relation("ContactTimers")

  sales Sale[] @relation("ContactSales")
}

model CallSession {
  id          String    @id @default(cuid())
  userId      String
  //   d√° nome √† rela√ß√£o e aponta o lado oposto em User.sessions
  user        User      @relation("UserSessions", fields: [userId], references: [id])
  startedAt   DateTime  @default(now())
  endedAt     DateTime?
  durationSec Int?

  //   liga aos timers desta sess√£o
  contactTimes ContactTimer[] @relation("SessionContactTimers")
}

model ContactTimer {
  id String @id @default(cuid())

  //   rela√ß√£o (opcional) para a sess√£o e respetivo lado oposto
  sessionId String?
  session   CallSession? @relation("SessionContactTimers", fields: [sessionId], references: [id])

  //   rela√ß√£o para o contacto e lado oposto em Contact.timers
  contactId String
  contact   Contact @relation("ContactTimers", fields: [contactId], references: [id])

  //   rela√ß√£o para o utilizador e lado oposto em User.contactTimers
  userId String
  user   User   @relation("UserContactTimers", fields: [userId], references: [id])

  startedAt   DateTime  @default(now())
  endedAt     DateTime?
  durationSec Int?
}
